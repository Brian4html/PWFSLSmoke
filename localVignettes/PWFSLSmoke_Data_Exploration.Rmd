---
title: "PWFSLSmoke Data Exploration"
author: "Rex Thompson - Mazama Science"
date: '`r Sys.Date()`'
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{PWFSLSmoke Data Exploration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=5)
```

This vignette offers examples of how the PWFSLSmoke package can be used to enable data exploration while supporting a variety of common tasks and questions.

# Package Setup

First things first, we need to load the PWFSLSmoke package and set up logging. You can pass
arguments to the `logger.setup()` function to send logging information to log files. In the following
example we use `logger.setLevel()` to send any ERROR output to the console.

```{r Setup, message=FALSE}
library(PWFSLSmoke)
logger.setup()
logger.setLevel(ERROR)
```

We'll also need to load MazamaSpatialUtils, which can be done with the code below.

```{r Spatial Utils}
library(MazamaSpatialUtils)
setSpatialDataDir('~/Data/Spatial')
loadSpatialData('NaturalEarthAdm1')
```

If the previous code above gives an error, you may need to download Mazama spatial data files. To do so, enter the following in the command line:

`mkdir ~/Data`  
`cd ~/Data`  
`curl -OL http://smoke.airfire.org/RData/Spatial.tar.gz`  
`tar -xzf Spatial.tar.gz`  
`rm Spatial.tar.gz`

If you are still having trouble setting things up, refer to the full package documentation and README at the following link: https://github.com/MazamaScience/PWFSLSmoke

# Data Acquisition

After the PWFSLSmoke and the packages it depends upon are loaded, we can gather some monitoring data to work with. This can be done in two ways -- the first we'll address is the creation of a ws_monitor object.

## ws_monitor Object

A ws_monitor object is the basis for the entire PWFSLSmoke package. Simply put, a ws_monitor object is a data structure that the PWFSLSmoke package depends upon for its many functions to work properly. It consists of a few constraints:

* Constraint 1
* Constrains 2

To create a ws_monitor object, we call one of the "createMonitorObject" functions like the one shown below. See the "E-Sampler_Data_Handling" Vignette for a detailed look at what goes on in the function shown below, including download, parsing, QA/QC and clustering of the data.

```{r}
ws_monitor <- airnow_load(20160901,20161015,stateCodes = "WA")
plain <- airsis_createMonitorObject(20160901, 20161015, provider='USFS', unitID=1033 )
```



We can use a variety of functions to manipulate ws_monitor objects. The monitor_subset function can also be used to pull out one or more monitors from a multi-monitor ws_monitor object (recall that ws_monitor objects can contain data for more than one monitor). Below, we'll use the monitor_subset() function to subset our data above over a specific time period. 

```{r}
plain <- monitor_subset(plain,tlim = c(20160905,20160930))
```



```{r}
monitorPlot_rollingMean(plain)
```

The steps above (to be expanded) can be used to create a ws_monitor object that conforms to internal data format standards which enables the use of tools developed specifically to handle such objecs. See _____ for more informtion on the ws_monitor data structure.

We can also create a raw dataframe. This process is similar.

```{r raw}
df <- PWFSLSmoke::airsis_createRawDataframe(20160901, 20161015, provider='USFS', unitID=1033)
```

Now to clean the data

```{r}
df <- raw_enhance(df,rawSource='AIRSIS')
```

Now you have a nice raw dataset with which to work.



Make a plot

```{r}
rawPlot_windRose(df,ws.int=1)
```



STRUCTURE:
 - Setup
 - ws_monitor object creation
 - ws_monitor plots and other goodies
 - raw_enhance object creation
 - raw_enhance plots and other goodies

# Put it all together
 
 Make a bunch of plots that are all related?
 
# Conclusion

R is powerful. We have developed solid tools. Lots of good stuff we can do now.

The end.
